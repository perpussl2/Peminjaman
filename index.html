<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Kunjungan Perpustakaan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        .glass {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .glass-modal {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }
        .glass-button {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }
        .glass-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        .glass-input {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .glass-input:focus {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .modal {
            backdrop-filter: blur(8px);
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
    </style>
</head>
<body class="min-h-screen bg-pattern" style="background-image: url('background.jpg'); background-size: cover; background-position: center; background-attachment: fixed;"></body>

    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <div class="glass rounded-3xl p-6 max-w-md mx-auto floating">
                <img src="logo.png" alt="Logo Perpustakaan" class="mx-auto mb-4 h-20 w-20 object-contain" onerror="this.style.display='none';">
                <h1 class="text-4xl font-bold text-white mb-2 drop-shadow-lg">📚 Perpustakaan Sekolah</h1>
                <p class="text-lg text-white drop-shadow-md">Sistem Kunjungan Digital</p>
                
                <!-- Counter Pengunjung -->
                <div class="mt-4 glass rounded-2xl p-4">
                    <div class="flex items-center justify-center space-x-3">
                        <span class="text-2xl">👥</span>
                        <div class="text-center">
                            <p class="text-sm text-white/80 font-medium">Total Pengunjung Hari Ini</p>
                            <p id="visitorCount" class="text-3xl font-bold text-white">0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Card -->
        <div class="max-w-md mx-auto glass rounded-3xl p-8">
            <form id="visitForm" class="space-y-6">
                <!-- Nomor Induk -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nomor Induk</label>
                    <input type="text" id="nomorInduk" required
                           class="w-full px-4 py-3 glass-input rounded-xl focus:outline-none transition-all"
                           placeholder="Masukkan nomor induk">
                </div>

                <!-- Nama -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Lengkap</label>
                    <input type="text" id="nama" required
                           class="w-full px-4 py-3 glass-input rounded-xl focus:outline-none transition-all"
                           placeholder="Masukkan nama lengkap">
                </div>

                <!-- Kategori Pengunjung -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Kategori Pengunjung</label>
                    <button type="button" id="kelasBtn"
                            class="w-full px-4 py-3 glass-button rounded-xl text-left focus:outline-none flex justify-between items-center">
                        <span id="kelasText" class="text-gray-500">Pilih kategori pengunjung</span>
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                </div>

                <!-- Tujuan Kunjungan -->
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tujuan Kunjungan</label>
                    <button type="button" id="tujuanBtn"
                            class="w-full px-4 py-3 glass-button rounded-xl text-left focus:outline-none flex justify-between items-center">
                        <span id="tujuanText" class="text-gray-500">Pilih tujuan kunjungan</span>
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                </div>

                <!-- Input Lainnya (Hidden by default) -->
                <div id="lainnyaDiv" class="hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Tujuan Lainnya</label>
                    <input type="text" id="tujuanLainnya"
                           class="w-full px-4 py-3 glass-input rounded-xl focus:outline-none transition-all"
                           placeholder="Sebutkan tujuan kunjungan">
                </div>

                <!-- Submit Button -->
                <button type="submit"
                        class="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-xl transition-all shadow-lg hover:shadow-xl transform hover:scale-105">
                    Submit
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Kelas -->
    <div id="kelasModal" class="fixed inset-0 bg-black bg-opacity-30 modal hidden flex items-center justify-center z-50">
        <div class="glass-modal rounded-3xl p-6 m-4 max-w-sm w-full fade-in">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">Pilih Kategori Pengunjung</h3>
            <div class="grid grid-cols-3 gap-3">
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="X-1">X-1</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="X-2">X-2</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="X-3">X-3</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="X-4">X-4</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XI-1">XI-1</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XI-2">XI-2</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XI-3">XI-3</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XI-4">XI-4</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XII-1">XII-1</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XII-2">XII-2</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XII-3">XII-3</button>
                <button class="kelas-option glass-button text-gray-700 py-2 px-3 rounded-xl text-sm font-medium" data-kelas="XII-4">XII-4</button>
                <button class="kelas-option glass-button text-green-700 py-2 px-3 rounded-xl text-sm font-medium col-span-2 bg-gradient-to-r from-green-200 to-emerald-200" data-kelas="Pendidik">Pendidik</button>
                <button class="kelas-option glass-button text-green-700 py-2 px-3 rounded-xl text-sm font-medium bg-gradient-to-r from-green-200 to-emerald-200" data-kelas="Kependidikan">Kependidikan</button>
            </div>
            <button id="closeKelasModal" class="w-full mt-4 glass-button text-gray-700 py-2 px-4 rounded-xl">
                Tutup
            </button>
        </div>
    </div>

    <!-- Modal Tujuan -->
    <div id="tujuanModal" class="fixed inset-0 bg-black bg-opacity-30 modal hidden flex items-center justify-center z-50">
        <div class="glass-modal rounded-3xl p-6 m-4 max-w-sm w-full fade-in">
            <h3 class="text-lg font-semibold text-gray-800 mb-4 text-center">Pilih Tujuan Kunjungan</h3>
            <div class="space-y-2">
                <button class="tujuan-option w-full text-left glass-button text-gray-700 py-3 px-4 rounded-xl" data-tujuan="Membaca">📖 Membaca</button>
                <button class="tujuan-option w-full text-left glass-button text-gray-700 py-3 px-4 rounded-xl" data-tujuan="Meminjam buku">📚 Meminjam buku</button>
                <button class="tujuan-option w-full text-left glass-button text-gray-700 py-3 px-4 rounded-xl" data-tujuan="Mengembalikan buku">📤 Mengembalikan buku</button>
                <button class="tujuan-option w-full text-left glass-button text-gray-700 py-3 px-4 rounded-xl" data-tujuan="Mengerjakan tugas">✏️ Mengerjakan tugas</button>
                <button class="tujuan-option w-full text-left glass-button text-gray-700 py-3 px-4 rounded-xl" data-tujuan="Diskusi kelompok">👥 Diskusi kelompok</button>
                <button class="tujuan-option w-full text-left glass-button text-gray-700 py-3 px-4 rounded-xl" data-tujuan="Lainnya">📝 Lainnya</button>
            </div>
            <button id="closeTujuanModal" class="w-full mt-4 glass-button text-gray-700 py-2 px-4 rounded-xl">
                Tutup
            </button>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="fixed inset-0 bg-black bg-opacity-30 modal hidden flex items-center justify-center z-50">
        <div class="glass-modal rounded-3xl p-8 m-4 max-w-md w-full fade-in text-center">
            <h3 class="text-2xl font-bold text-gray-800 mb-2">Selamat Berkunjung</h3>
            <p id="welcomeName" class="text-lg text-gray-600 mb-6"></p>
            <button id="closeWelcomeModal" class="glass-button text-gray-700 font-semibold py-2 px-6 rounded-xl">
                Tutup
            </button>
        </div>
    </div>

    <script>
        // Variables
        let selectedKelas = '';
        let selectedTujuan = '';

        // Modal elements
        const kelasModal = document.getElementById('kelasModal');
        const tujuanModal = document.getElementById('tujuanModal');
        const welcomeModal = document.getElementById('welcomeModal');
        const kelasBtn = document.getElementById('kelasBtn');
        const tujuanBtn = document.getElementById('tujuanBtn');
        const kelasText = document.getElementById('kelasText');
        const tujuanText = document.getElementById('tujuanText');
        const lainnyaDiv = document.getElementById('lainnyaDiv');
        const welcomeName = document.getElementById('welcomeName');
        const visitorCountElement = document.getElementById('visitorCount');

        // Visitor counter functions
        function getTodayKey() {
            return 'visitorCount_' + new Date().toDateString();
        }

        function getVisitorCount() {
            const todayKey = getTodayKey();
            return parseInt(localStorage.getItem(todayKey) || '0');
        }

        function incrementVisitorCount() {
            const todayKey = getTodayKey();
            const currentCount = getVisitorCount();
            const newCount = currentCount + 1;
            localStorage.setItem(todayKey, newCount.toString());
            updateVisitorDisplay();
            return newCount;
        }

        function updateVisitorDisplay() {
            const count = getVisitorCount();
            visitorCountElement.textContent = count;
        }

        // Initialize visitor count display
        updateVisitorDisplay();

        // Open modals
        kelasBtn.addEventListener('click', () => {
            kelasModal.classList.remove('hidden');
        });

        tujuanBtn.addEventListener('click', () => {
            tujuanModal.classList.remove('hidden');
        });

        // Close modals
        document.getElementById('closeKelasModal').addEventListener('click', () => {
            kelasModal.classList.add('hidden');
        });

        document.getElementById('closeTujuanModal').addEventListener('click', () => {
            tujuanModal.classList.add('hidden');
        });

        document.getElementById('closeWelcomeModal').addEventListener('click', () => {
            welcomeModal.classList.add('hidden');
        });

        // Close modals when clicking outside
        kelasModal.addEventListener('click', (e) => {
            if (e.target === kelasModal) {
                kelasModal.classList.add('hidden');
            }
        });

        tujuanModal.addEventListener('click', (e) => {
            if (e.target === tujuanModal) {
                tujuanModal.classList.add('hidden');
            }
        });

        // Handle kelas selection
        document.querySelectorAll('.kelas-option').forEach(button => {
            button.addEventListener('click', () => {
                selectedKelas = button.dataset.kelas;
                kelasText.textContent = selectedKelas;
                kelasText.classList.remove('text-gray-500');
                kelasText.classList.add('text-gray-800');
                kelasModal.classList.add('hidden');
            });
        });

        // Handle tujuan selection
        document.querySelectorAll('.tujuan-option').forEach(button => {
            button.addEventListener('click', () => {
                selectedTujuan = button.dataset.tujuan;
                tujuanText.textContent = button.textContent;
                tujuanText.classList.remove('text-gray-500');
                tujuanText.classList.add('text-gray-800');
                
                // Show/hide "Lainnya" input
                if (selectedTujuan === 'Lainnya') {
                    lainnyaDiv.classList.remove('hidden');
                } else {
                    lainnyaDiv.classList.add('hidden');
                    document.getElementById('tujuanLainnya').value = '';
                }
                
                tujuanModal.classList.add('hidden');
            });
        });

        // Handle form submission
        document.getElementById('visitForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const nomorInduk = document.getElementById('nomorInduk').value;
            const nama = document.getElementById('nama').value;
            const tujuanLainnya = document.getElementById('tujuanLainnya').value;
            
            // Validation
            if (!nomorInduk || !nama || !selectedKelas || !selectedTujuan) {
                alert('Mohon lengkapi semua field yang diperlukan!');
                return;
            }
            
            if (selectedTujuan === 'Lainnya' && !tujuanLainnya) {
                alert('Mohon sebutkan tujuan kunjungan lainnya!');
                return;
            }
            
            // Increment visitor count
            const visitorNumber = incrementVisitorCount();
            
            // Show welcome modal
            welcomeName.textContent = nama;
            welcomeModal.classList.remove('hidden');
            
            // Auto close welcome modal after 3 seconds
            setTimeout(() => {
                welcomeModal.classList.add('hidden');
            }, 3000);
            
            // Reset form
            document.getElementById('visitForm').reset();
            selectedKelas = '';
            selectedTujuan = '';
            kelasText.textContent = 'Pilih kategori pengunjung';
            kelasText.classList.add('text-gray-500');
            kelasText.classList.remove('text-gray-800');
            tujuanText.textContent = 'Pilih tujuan kunjungan';
            tujuanText.classList.add('text-gray-500');
            tujuanText.classList.remove('text-gray-800');
            lainnyaDiv.classList.add('hidden');
            
            // Send data to Google Sheets
            const dataToSend = {
                nomorInduk,
                nama,
                kategori: selectedKelas,
                tujuan: selectedTujuan === 'Lainnya' ? tujuanLainnya : selectedTujuan,
                waktu: new Date().toLocaleString('id-ID')
            };
            
            // Replace with your Google Apps Script Web App URL
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxFvfaC5f01vBay_IM-1m0dQ_HkFWUO-2xSFqvg8L0dtaStjsh2b1Qs_fyCE8Uu-VvulA/exec';
            
            // Send to Google Sheets
            fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify(dataToSend),
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Data berhasil dikirim ke Google Sheets:', data);
            })
            .catch(error => {
                console.error('Error mengirim data:', error);
                // Data tetap tersimpan di console untuk backup
                console.log('Data kunjungan (backup):', dataToSend);
            });
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98a28b4011e7aa09',t:'MTc1OTcyNjI5MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
