<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Sirkulasi Perpustakaan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .glass-dark {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .bg-pattern {
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(59, 130, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(147, 51, 234, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(16, 185, 129, 0.2) 0%, transparent 50%);
            background-size: 400px 400px, 300px 300px, 500px 500px;
            animation: float 20s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { background-position: 0% 0%, 100% 100%, 50% 50%; }
            50% { background-position: 100% 100%, 0% 0%, 25% 75%; }
        }
        
        .logo-container {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .logo-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-dipinjam {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-tersedia {
            background: rgba(34, 197, 94, 0.2);
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .form-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: white;
        }
        
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .form-input:focus {
            outline: none;
            border-color: rgba(102, 126, 234, 0.5);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
    </style>
</head>
<body class="min-h-screen bg-pattern" style="background-image: url('background.jpg'); background-size: cover; background-position: center; background-attachment: fixed;">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="glass rounded-2xl p-6 mb-8">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center gap-4">
                    <div class="logo-container">
                        <img src="logo.png" alt="Logo Perpustakaan" onerror="this.style.display='none'; this.parentElement.innerHTML='üìö'; this.parentElement.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.parentElement.style.color='white'; this.parentElement.style.fontSize='24px'; this.parentElement.style.fontWeight='bold';">
                    </div>
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-white">Sistem Sirkulasi Perpustakaan</h1>
                        <p class="text-blue-200">Kelola peminjaman buku dengan mudah</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-white font-semibold" id="currentDate"></div>
                    <div class="text-blue-200 text-sm" id="currentTime"></div>
                </div>
            </div>
        </div>

        <!-- Form Section -->
        <div class="max-w-2xl mx-auto">
            <div class="glass rounded-2xl p-8">
                <h2 class="text-2xl font-bold text-white mb-8 flex items-center justify-center gap-3">
                    <span class="text-3xl">üìñ</span>
                    Form Transaksi Buku
                </h2>
                
                <form id="transactionForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-blue-200 text-sm font-medium mb-3">Nomor Induk Buku</label>
                            <input type="text" id="bookId" class="form-input w-full px-6 py-4 rounded-xl text-lg" placeholder="Masukkan ID buku" required>
                        </div>
                        <div>
                            <label class="block text-blue-200 text-sm font-medium mb-3">Nomor Induk Peminjam</label>
                            <input type="text" id="borrowerId" class="form-input w-full px-6 py-4 rounded-xl text-lg" placeholder="Masukkan ID peminjam" required>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-blue-200 text-sm font-medium mb-3">Nama Peminjam</label>
                        <input type="text" id="borrowerName" class="form-input w-full px-6 py-4 rounded-xl text-lg" placeholder="Masukkan nama lengkap" required>
                    </div>
                    
                    <div>
                        <label class="block text-blue-200 text-sm font-medium mb-3">Judul Buku</label>
                        <input type="text" id="bookTitle" class="form-input w-full px-6 py-4 rounded-xl text-lg" placeholder="Masukkan judul buku" required>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 pt-6">
                        <button type="button" onclick="borrowBook()" class="btn-primary text-white px-8 py-4 rounded-xl font-semibold flex items-center justify-center gap-3 hover:scale-105 transition-all text-lg">
                            <span class="text-xl">üìö</span>
                            Pinjam Buku
                        </button>
                        <button type="button" onclick="returnBook()" class="btn-success text-white px-8 py-4 rounded-xl font-semibold flex items-center justify-center gap-3 hover:scale-105 transition-all text-lg">
                            <span class="text-xl">‚úÖ</span>
                            Kembalikan
                        </button>
                        <button type="button" onclick="extendBook()" class="btn-warning text-white px-8 py-4 rounded-xl font-semibold flex items-center justify-center gap-3 hover:scale-105 transition-all text-lg">
                            <span class="text-xl">‚è∞</span>
                            Perpanjang
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Popup Notification -->
        <div id="popupOverlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 hidden flex items-center justify-center">
            <div id="popupModal" class="glass rounded-2xl p-8 mx-4 max-w-md w-full transform scale-95 transition-all duration-300">
                <div class="text-center">
                    <div id="popupIcon" class="text-6xl mb-4"></div>
                    <h3 id="popupTitle" class="text-xl font-bold text-white mb-2"></h3>
                    <p id="popupMessage" class="text-blue-200 mb-6"></p>
                    <button onclick="closePopup()" class="btn-primary text-white px-6 py-3 rounded-lg font-semibold hover:scale-105 transition-all">
                        OK
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let borrowingData = JSON.parse(localStorage.getItem('borrowingData')) || [];
        
        // Update date and time
        function updateDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            };
            
            document.getElementById('currentDate').textContent = now.toLocaleDateString('id-ID', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('id-ID', timeOptions);
        }
        
        // Show popup notification
        function showAlert(message, type = 'info') {
            const overlay = document.getElementById('popupOverlay');
            const modal = document.getElementById('popupModal');
            const icon = document.getElementById('popupIcon');
            const title = document.getElementById('popupTitle');
            const messageEl = document.getElementById('popupMessage');
            
            const config = {
                success: { icon: '‚úÖ', title: 'Berhasil!', color: 'text-green-400' },
                error: { icon: '‚ùå', title: 'Error!', color: 'text-red-400' },
                warning: { icon: '‚ö†Ô∏è', title: 'Peringatan!', color: 'text-yellow-400' },
                info: { icon: '‚ÑπÔ∏è', title: 'Informasi', color: 'text-blue-400' }
            };
            
            const currentConfig = config[type];
            icon.textContent = currentConfig.icon;
            title.textContent = currentConfig.title;
            title.className = `text-xl font-bold mb-2 ${currentConfig.color}`;
            messageEl.textContent = message;
            
            overlay.classList.remove('hidden');
            setTimeout(() => {
                modal.classList.remove('scale-95');
                modal.classList.add('scale-100');
            }, 50);
        }
        
        // Close popup
        function closePopup() {
            const overlay = document.getElementById('popupOverlay');
            const modal = document.getElementById('popupModal');
            
            modal.classList.remove('scale-100');
            modal.classList.add('scale-95');
            
            setTimeout(() => {
                overlay.classList.add('hidden');
            }, 300);
        }
        
        // Calculate return date
        function calculateReturnDate(borrowDate, days) {
            const date = new Date(borrowDate);
            date.setDate(date.getDate() + days);
            return date;
        }
        
        // Format date for display
        function formatDate(date) {
            return new Date(date).toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }
        
        // Check if book is overdue
        function isOverdue(returnDate) {
            return new Date() > new Date(returnDate);
        }
        
        // Find book by ID
        function findBookById(bookId) {
            return borrowingData.find(book => book.bookId === bookId);
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('borrowingData', JSON.stringify(borrowingData));
            updateDisplay();
        }
        
        // Google Apps Script Web App URL - Ganti dengan URL Web App Anda
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyLdogbETMJHn-gvNVUMyqOhU8BizVFh65x5ZiMgPGaJ3RgRvIAFHUwd6AjpDj-oKkkvQ/exec';
        
        // Send data to Google Sheets
        async function sendToGoogleSheets(action, data) {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: action,
                        data: data
                    })
                });
                
                console.log('Data berhasil dikirim ke Google Sheets');
                return true;
            } catch (error) {
                console.error('Error mengirim data ke Google Sheets:', error);
                return false;
            }
        }
        
        // Borrow book function
        async function borrowBook() {
            const bookId = document.getElementById('bookId').value.trim();
            const borrowerId = document.getElementById('borrowerId').value.trim();
            const borrowerName = document.getElementById('borrowerName').value.trim();
            const bookTitle = document.getElementById('bookTitle').value.trim();
            
            if (!bookId || !borrowerId || !borrowerName || !bookTitle) {
                showAlert('Mohon lengkapi semua field!', 'error');
                return;
            }
            
            const existingBook = findBookById(bookId);
            if (existingBook && existingBook.status === 'dipinjam') {
                showAlert('Buku sedang dipinjam oleh orang lain!', 'error');
                return;
            }
            
            const borrowDate = new Date();
            const returnDate = calculateReturnDate(borrowDate, 7);
            
            const bookData = {
                bookId,
                borrowerId,
                borrowerName,
                bookTitle,
                borrowDate: borrowDate.toISOString(),
                returnDate: returnDate.toISOString(),
                status: 'dipinjam',
                extensions: 0
            };
            
            // Kirim data ke Google Sheets
            const sheetData = {
                bookId,
                borrowerId,
                borrowerName,
                bookTitle,
                borrowDate: formatDate(borrowDate),
                returnDate: formatDate(returnDate),
                status: 'Dipinjam',
                timestamp: new Date().toLocaleString('id-ID')
            };
            
            await sendToGoogleSheets('BORROW', sheetData);
            
            if (existingBook) {
                const index = borrowingData.findIndex(book => book.bookId === bookId);
                borrowingData[index] = bookData;
            } else {
                borrowingData.push(bookData);
            }
            
            saveData();
            clearForm();
            showAlert(`Buku "${bookTitle}" berhasil dipinjam oleh ${borrowerName}! Harus dikembalikan pada ${formatDate(returnDate)}`, 'success');
        }
        
        // Return book function
        async function returnBook() {
            const bookId = document.getElementById('bookId').value.trim();
            
            if (!bookId) {
                showAlert('Masukkan Nomor Induk Buku!', 'error');
                return;
            }
            
            const bookIndex = borrowingData.findIndex(book => book.bookId === bookId);
            if (bookIndex === -1) {
                showAlert('Buku tidak ditemukan!', 'error');
                return;
            }
            
            const book = borrowingData[bookIndex];
            if (book.status !== 'dipinjam') {
                showAlert('Buku tidak sedang dipinjam!', 'error');
                return;
            }
            
            // Kirim data pengembalian ke Google Sheets
            const returnData = {
                bookId: book.bookId,
                borrowerId: book.borrowerId,
                borrowerName: book.borrowerName,
                bookTitle: book.bookTitle,
                borrowDate: formatDate(new Date(book.borrowDate)),
                returnDate: formatDate(new Date()),
                status: 'Dikembalikan',
                timestamp: new Date().toLocaleString('id-ID')
            };
            
            await sendToGoogleSheets('RETURN', returnData);
            
            borrowingData.splice(bookIndex, 1);
            saveData();
            clearForm();
            showAlert(`Buku "${book.bookTitle}" berhasil dikembalikan!`, 'success');
        }
        
        // Extend book function
        async function extendBook() {
            const bookId = document.getElementById('bookId').value.trim();
            
            if (!bookId) {
                showAlert('Masukkan Nomor Induk Buku!', 'error');
                return;
            }
            
            const book = findBookById(bookId);
            if (!book) {
                showAlert('Buku tidak ditemukan!', 'error');
                return;
            }
            
            if (book.status !== 'dipinjam') {
                showAlert('Buku tidak sedang dipinjam!', 'error');
                return;
            }
            
            if (book.extensions >= 2) {
                showAlert('Buku sudah diperpanjang maksimal 2 kali!', 'error');
                return;
            }
            
            const newReturnDate = calculateReturnDate(book.returnDate, 4);
            book.returnDate = newReturnDate.toISOString();
            book.extensions += 1;
            
            // Kirim data perpanjangan ke Google Sheets
            const extendData = {
                bookId: book.bookId,
                borrowerId: book.borrowerId,
                borrowerName: book.borrowerName,
                bookTitle: book.bookTitle,
                borrowDate: formatDate(new Date(book.borrowDate)),
                newReturnDate: formatDate(newReturnDate),
                extensionCount: book.extensions,
                status: 'Diperpanjang',
                timestamp: new Date().toLocaleString('id-ID')
            };
            
            await sendToGoogleSheets('EXTEND', extendData);
            
            saveData();
            clearForm();
            showAlert(`Buku "${book.bookTitle}" berhasil diperpanjang sampai ${formatDate(newReturnDate)}`, 'success');
        }
        
        // Clear form
        function clearForm() {
            document.getElementById('transactionForm').reset();
        }
        

        
        // Update display (simplified - no UI display needed)
        function updateDisplay() {
            // Data is stored but not displayed in UI
        }
        

        
        // Initialize
        function init() {
            updateDateTime();
            setInterval(updateDateTime, 1000);
            updateDisplay();
        }
        
        // Start the application
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98a19b1e03040fad',t:'MTc1OTcxNjQ1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
